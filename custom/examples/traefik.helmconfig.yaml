---

apiVersion: 'helm.cattle.io/v1'
kind: 'HelmChartConfig'
metadata:
  name: 'traefik'
  namespace: 'kube-system'
spec:
  #
  # These values allow the correct forwarding of client IPs via X-Forwarded-* headers
  #
  valuesContent: |-
    additionalArguments:
      - '--log.level=INFO'
      - '--ping'
      - '--metrics.prometheus'

    deployment:
      kind: 'DaemonSet'

    # no load balancer
    service:
      enabled: false

    # use host network for directly port listening
    hostNetwork: true

    ports:
      web:
        port: 80
        expose: true
        protocol: 'TCP'
        exposePort: 80
        # Enable to always redirect to https
        redirectTo: websecure
      websecure:
        port: 443
        expose: true
        protocol: 'TCP'
        exposePort: 443
        tls:
          enable: true

    # run as root to 80 and 443 port listen permission
    securityContext:
      capabilities:
        add:
          - 'NET_BIND_SERVICE'
      runAsNonRoot: false
      runAsUser: 0

